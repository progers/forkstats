<!DOCTYPE HTML>
<html>
<script src="d3.js" charset="utf-8"></script>
<script src="linesOfCode.js"></script>
<script src="commitsByDay.js"></script>
<script src="commitsByOrganization.js"></script>
<ascript src="averageCommitsByDay.js"></ascript>
<script src="topFiles.js"></script>
<script src="commitsByMonthAppleGoogle.js"></script>
<style>
  body {
    font-family: "Open Sans",Calibri,Candara,Arial,sans-serif;
    font-size: 15px;
    max-width: 860px;
    background: #fff;
    color: #333;
    margin-right: auto;
    margin-left: auto;
    padding-right: 15px;
    padding-left: 15px;
  }
  h1, h2, h3 {
    font-weight: 300;
  }
  h2, h3 {
    margin-top: 2em;
    margin-bottom: -0.5em;
  }
  .box {
    background: #fff;
    border-color: #888;
  }
  .timeline {
    width: 300px;
    border: 1px solid;
    padding: 5px;
    float: right;
    margin: 5px;
    margin-right: -75px;
  }
  .timeline table tr td {
    vertical-align: top;
    padding: 5px;
  }
  .timeline .leftcolumn {
    text-align: right;
  }
  .graph {
    font-size: 10px;
    margin-right: -75px;
    margin-left: -75px;
  }
  #topFiles {
    margin-left: 0px;
  }

  .axis path, .axis line {
    fill: none;
    stroke: #000;
  }
  .x.axis path {
    fill: none;
    stroke: #000;
  }
  .line {
    fill: none;
    stroke: steelblue;
    stroke-width: 1.5px;
  }
  .forkline {
    stroke: steelblue;
    stroke-width: 1px;
    stroke-dasharray: 3 3;
    stroke-opacity: 0.2;
  }
  #commitsByDay {
  }
  .topFilesNode {
    border: solid 1px white;
    font: 10px sans-serif;
    line-height: 12px;
    overflow: hidden;
    position: absolute;
    text-indent: 2px;
  }
  #topFiles div {
    float: left;
  }
  .topFilesTitle {
    overflow: hidden;
    position: absolute;
    text-align: right;
  }
  .textBackground {
    stroke-width: 3px;
    stroke: white;
    fill: white;
  }
</style>
<body>
<h1>A high-profile fork: one year of Blink and Webkit</h1>
<div class="box timeline">
  <table>
    <tr><td class="leftcolumn">1998/11/4</td><td>KHTML born</td></tr>
    <tr><td class="leftcolumn">2003/1/7</td><td>Webkit forks KHTML (<a href="http://lists.kde.org/?m=104197092318639">kfm-devel post</a>)</td></tr>
    <tr><td class="leftcolumn">2013/2/13</td><td>Opera switches to Chromium (<a href="https://web.archive.org/web/20140221033629/http://my.opera.com/haavard/blog/2013/02/13/webkit">post</a>)</td></tr>
    <tr><td class="leftcolumn">2013/4/3</td><td>Blink forks WebKit (<a href="http://blog.chromium.org/2013/04/blink-rendering-engine-for-chromium.html">post</a>)</td></tr>
    <tr><td class="leftcolumn">2013/5/21</td><td>Tech reporting is terrible v1 (<a href="http://news.softpedia.com/news/For-Chrome-s-Blink-Google-Has-Already-Removed-8-8-Million-Lines-of-WebKit-Code-354831.shtml">8.8M LOC</a>)</td></tr>
    <tr><td class="leftcolumn">2013/5/22</td><td>Tech reporting is terrible v2 (<a href="http://news.softpedia.com/news/WebKit-Removes-8-8-Million-of-Code-After-Google-s-Departure-355192.shtml">8.8M LOC</a>)</td></tr>
    <tr><td class="leftcolumn">2013/9/12</td><td>QT switches from WebKit to Blink (<a href="https://lists.webkit.org/pipermail/webkit-dev/2013-September/025449.html">webkit-dev</a>)</td></tr>
    <tr><td class="leftcolumn">2014/1/23</td><td>CSS Regions dropped from Blink (<a href="https://groups.google.com/a/chromium.org/d/msg/blink-dev/kTktlHPJn4Q/YrnfLxeMO7IJ">post</a>)</td></tr>
  </table>
</div>

<p>In 2013 the <a href="http://en.wikipedia.org/wiki/Browser_wars">browser wars</a> sprouted a new rendering engine: Blink. When Blink forked in April 2013, Webkit had 1.8 million lines of C++, <a href="https://www.ohloh.net/p/WebKit">2,500</a> commits per month and was the most popular browser engine. On mobile, Webkit backed the top 3 browsers (Apple Safari, Google Chrome, Android Browser), accounting for over 75% of mobile browsers. This post is a look at the Blink/Webkit fork one year later: how have the projects diverged, who is driving them, and where are they headed?</p>

<h2>What is a browser engine?</h2>
<p>A discussion of Blink and Webkit has to define exactly which parts are the core engine. For example, Webkit contains a first-class javascript engine (JSC) and two application layers (Webkit1 and the multiprocess Webkit2), neither of which are in Blink. In this discussion, "Source/" is the C++ code of the Webkit project (including JSC, etc.) and "core" is just the common code shared by Blink and Webkit such as Source/WebCore and Source/WTF.</p>
<p>In part due to not understanding the subtle differences between the projects, the ever-lazy tech media reported Blink removed <a href="http://www.engadget.com/2013/05/16/google-blink-team-pulls-8-8-million-lines-of-webkit-code/">8.8 million lines of code</a>. One wonders how Blink manages to run on -7 million lines of code! "git diff --stat" shows that over 8.8 million lines were actually deleted in Blink, primarily layout tests. Looking at the core code shared by both engines, Blink has 207,000 fewer lines of actual code (out of a total of 677,000 for Blink and 883,000 for Webkit. The tech media later didn't get <a href="http://trac.webkit.org/changeset/164131">a joke</a> by Andreas Kling and reported Webkit also <a href="http://news.softpedia.com/news/WebKit-Removes-8-8-Million-of-Code-After-Google-s-Departure-355192.shtml">removed 8.8 million lines</a> of ShadowDOM.</p>

<h2>Divergence</h2>
<p>The projects are quickly diverging due to differences in both resources and priorities. In terms of resources, Blink simply has a higher commit rate and, while commit rate is not necessarily a measure of progress, it is a rough proxy. The graph below shows the differences in commit rate over time.</p>
<div id="commitsByDay" class="graph"></div>
<p>
This is not unexpected since Google was the <a href="http://blog.bitergia.com/2013/02/06/report-on-the-activity-of-companies-in-the-webkit-project/">top contributor</a> to Webkit. In terms of core commit count, Blink has 6,000 commits more than Webkit, nearly as many commits Webkit has since the fork (8,700). While not directly comparable (see: What is a browser engine), Mozilla-central had nearly 50,000 commits in the same timeframe.
</p>
<p>
How did the fork affect Apple and Google's commit rates? Both organizations seem to have increased their commits post-fork. Whether this is due to competition or decreased friction is hard to tease out though.
<div id="commitsByMonthAppleGoogle" class="graph"></div>
</p>
<p>
words
<div id="linesOfCode" class="graph"></div>
</p>

<h2>The players</h2>
<div id="commitsByOrganization" class="graph"></div>
<p>
Samsung is the second-highest contributor to both projects although twice as many patches land in Blink. Opera and Igalia are the third largest contributors, solely to Blink and Webkit, respectively.
</p>

<h2>Priorities and revealed preferences</h2>
<p>
Blink has explicitly outlined goals in Eric Seidel's <a href="https://groups.google.com/a/chromium.org/d/topic/blink-dev/Z5OzwYh3Wfk/discussion">2014 brainstorming</a> post. A core theme is clearly mobile-focused performance. Webkit doesn't have stated goals but we can tease out each project's goals by looking at the top-modified files.
</p>
<div id="topFiles" class="graph"></div>
<p>
First, the resources difference is clear: both project's top-changed file is Document.cpp but Blink has 2.5x the number of changes. Blink has a strong focus on UseCounter metrics (which backs the <a href="http://www.chromestatus.com/metrics/feature/popularity">usage statistics</a>). Canvas and EvenHandler are also relatively popular in Blink. Webkit has a strong focus on text layout with top changes in RenderBlockLineLayout and RenderBlockFlow. Additionally, CSSParser, AccessibilityRenderObject, and Editing are all relatively popular in Webkit.
</p>

<h2>The future</h2>
<p>
TODO: write me
</p>


<div id="averageCommitsByDay" class="graph"></div>
<div id="averageCommitsByDayByOrganization" class="graph"></div>

</body>
</html>